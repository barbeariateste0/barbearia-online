<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Barbearia Neves — Marcação</title>
  <style>
    body{font-family:system-ui,Arial;margin:0;background:#0b0b0d;color:#fff}
    .wrap{max-width:560px;margin:0 auto;padding:24px}
    .card{background:#15151a;border:1px solid #23232b;border-radius:16px;padding:18px}
    label{display:block;margin:12px 0 6px;font-size:14px;color:#cfd2ff}
    input,select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid #2b2b36;background:#0f0f14;color:#fff}
    button{width:100%;margin-top:14px;padding:12px;border-radius:12px;border:0;background:#7c5cff;color:#fff;font-weight:700;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .ok{margin-top:12px;color:#70ffb3}
    .err{margin-top:12px;color:#ff6b6b}
    .small{font-size:12px;color:#aab}
    h1{margin:0 0 12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Marcar na Barbearia</h1>
    <div class="card">
      <form id="f">
        <label>Nome</label>
        <input id="nome" required placeholder="Ex: João Silva" />

        <label>Telefone</label>
        <input id="tel" required placeholder="Ex: 912345678" />

        <label>Data</label>
        <input id="data" type="date" required />

        <label>Hora</label>
        <input id="hora" type="time" required />

        <label>Serviço</label>
        <select id="servico">
          <option>Corte</option>
          <option>Barba</option>
          <option>Corte+Barba</option>
        </select>

        <label>Barbeiro</label>
        <select id="barbeiro">
          <option>Rui</option>
          <option>Ana</option>
          <option>Carlos</option>
        </select>

        <label>Notas (opcional)</label>
        <textarea id="notas" rows="3" placeholder="Ex: fazer degradê"></textarea>

        <button id="btn" type="submit">Confirmar marcação</button>
        <div id="msg" class="small"></div>
      </form>
    </div>

    <p class="small" style="margin-top:12px;">
      Depois metes este link na bio do Instagram ✅
    </p>
  </div>

  <script>
    // ✅ TROCA para a tua URL do Render (a do serviço python)
    const API_BASE = "https://barbearia-api.onrender.com";

    const f = document.getElementById("f");
    const btn = document.getElementById("btn");
    const msg = document.getElementById("msg");

    f.addEventListener("submit", async (e) => {
      e.preventDefault();
      msg.className = "small";
      msg.textContent = "A enviar...";

      btn.disabled = true;

      const payload = {
        nome: document.getElementById("nome").value.trim(),
        telefone: document.getElementById("tel").value.trim(),
        data: document.getElementById("data").value,   // YYYY-MM-DD
        hora: document.getElementById("hora").value,   // HH:MM
        servico: document.getElementById("servico").value,
        barbeiro: document.getElementById("barbeiro").value,
        notas: document.getElementById("notas").value.trim()
      };

      try {
        const r = await fetch(API_BASE + "/booking", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });

        const j = await r.json().catch(() => ({}));

        if (!r.ok) {
          throw new Error(j.detail || "Falha ao criar marcação.");
        }

        msg.className = "ok";
        msg.textContent = "✅ Marcação criada com sucesso!";
        f.reset();
      } catch (err) {
        msg.className = "err";
        msg.textContent = "❌ " + (err.message || "Erro");
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
