<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Barbearia Online ‚Äî Marca√ß√£o</title>
  <style>
    body{font-family:system-ui,Arial;margin:24px;max-width:720px}
    label{display:block;margin-top:12px;font-weight:600}
    input,select,textarea,button{width:100%;padding:10px;margin-top:6px;font-size:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .ok{background:#e7ffe7;padding:12px;border:1px solid #9be09b;margin-top:12px;display:none}
    .err{background:#ffe7e7;padding:12px;border:1px solid #e09b9b;margin-top:12px;display:none}
    button{cursor:pointer}
  </style>
</head>
<body>
  <h1>Marca√ß√£o online</h1>
  <p>Preenche e confirma. A marca√ß√£o entra automaticamente na agenda do PC.</p>

  <div id="ok" class="ok"></div>
  <div id="err" class="err"></div>

  <form id="f">
    <label>Nome</label>
    <input name="name" required placeholder="Nome do cliente">

    <div class="row">
      <div>
        <label>Telefone</label>
        <input name="phone" required placeholder="9xx xxx xxx">
      </div>
      <div>
        <label>Email (opcional)</label>
        <input name="email" type="email" placeholder="email@exemplo.com">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Servi√ßo</label>
        <select name="service" required>
          <option value="Corte">Corte</option>
          <option value="Barba">Barba</option>
          <option value="Corte+Barba">Corte+Barba</option>
        </select>
      </div>
      <div>
        <label>Barbeiro</label>
        <select name="barber" required>
          <option value="Pedro">Pedro Neves</option>
          <option value="Joao">Joao Leite</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Data</label>
        <input name="date" type="date" required>
      </div>
      <div>
        <label>Hora</label>
        <input name="time" type="time" required>
      </div>
    </div>

    <label>Dura√ß√£o (min)</label>
    <input name="dur" type="number" min="10" max="240" step="5" value="30" required>

    <label>Notas (opcional)</label>
    <textarea name="notes" rows="4" placeholder="Ex: atrasado 10 min, etc"></textarea>

    <button type="submit">Marcar</button>
  </form>

  <script>
    // üëá Mete aqui o teu Render URL
    const API_BASE = "https://barbearia-api-ki25.onrender.com/";

    const ok = document.getElementById('ok');
    const err = document.getElementById('err');

    function show(el, text) { el.textContent = text; el.style.display = 'block'; }
    function hide(el) { el.style.display = 'none'; }

    document.getElementById('f').addEventListener('submit', async (e) => {
      e.preventDefault();
      hide(ok); hide(err);

      const fd = new FormData(e.target);
      const payload = Object.fromEntries(fd.entries());

      // normaliza hora HH:MM
      if (payload.time && payload.time.length >= 5) payload.time = payload.time.slice(0,5);

      try {
        const r = await fetch(API_BASE + "/book", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        const data = await r.json().catch(()=> ({}));
        if (!r.ok) throw new Error(data.error || ("Erro HTTP " + r.status));

        show(ok, "‚úÖ Marca√ß√£o recebida! ID: " + (data.id || "(sem id)") + " ‚Äî vai entrar na agenda em segundos.");
        e.target.reset();
      } catch (ex) {
        show(err, "‚ùå N√£o foi poss√≠vel marcar: " + ex.message);
      }
    });
  </script>
</body>
</html>
